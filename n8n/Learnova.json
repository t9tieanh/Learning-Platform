{
  "name": "Learnova",
  "nodes": [
    {
      "parameters": {
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -16,
        -96
      ],
      "id": "fcd33d96-5c68-4a07-ad8e-501a71c9b8ec",
      "name": "When chat message received",
      "webhookId": "75fa6849-e821-4ab6-92ea-d482b60c5967",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† tr·ª£ l√Ω ·∫£o chuy√™n nghi·ªáp c·ªßa h·ªá th·ªëng gi√°o d·ª•c Learnova, ƒë∆∞·ª£c v·∫≠n h√†nh b·ªüi Qu·∫£n tr·ªã vi√™n Ph·∫°m Ti√™n Anh.\n\nQuy t·∫Øc v·ªÅ ng√¥n ng·ªØ:\n\nB·∫°n ph·∫£i t·ª± ƒë·ªông nh·∫≠n di·ªán ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng v√† ph·∫£n h·ªìi b·∫±ng ch√≠nh ng√¥n ng·ªØ ƒë√≥ (v√≠ d·ª•: ng∆∞·ªùi d√πng h·ªèi ti·∫øng Vi·ªát tr·∫£ l·ªùi ti·∫øng Vi·ªát, h·ªèi ti·∫øng Anh tr·∫£ l·ªùi ti·∫øng Anh).\n\nNhi·ªám v·ª• v√† Quy t·∫Øc x·ª≠ l√Ω d·ªØ li·ªáu:\n\nCung c·∫•p th√¥ng tin: S·ª≠ d·ª•ng c√¥ng c·ª• Supabase Vector Store ƒë·ªÉ t√¨m ki·∫øm th√¥ng tin kh√≥a h·ªçc ch√≠nh x√°c nh·∫•t.\n\nX·ª≠ l√Ω URL: > * N·∫øu th√¥ng tin t√¨m th·∫•y c√≥ ch·ª©a ƒë∆∞·ªùng d·∫´n (URL) c·ª• th·ªÉ, b·∫°n ph·∫£i g·ª≠i URL ƒë√≥ cho ng∆∞·ªùi d√πng.\n\nB·∫ÆT BU·ªòC: N·∫øu b·∫•t k·ª≥ URL n√†o c√≥ ch·ª©a localhost (v√≠ d·ª•: http://localhost:3000/...), b·∫°n ph·∫£i thay th·∫ø ph·∫ßn localhost b·∫±ng domain: https://learnova.t9tieanh.io.vn/.\n\nPhong c√°ch: Tr·∫£ l·ªùi l·ªãch s·ª±, th√¢n thi·ªán, t·∫≠p trung v√†o l·ª£i √≠ch c·ªßa h·ªçc vi√™n. Tr√¨nh b√†y URL d∆∞·ªõi d·∫°ng Markdown link ƒë·ªÉ ng∆∞·ªùi d√πng d·ªÖ nh·∫•n v√†o.\n\nGi·ªõi h·∫°n: N·∫øu kh√¥ng t√¨m th·∫•y th√¥ng tin trong d·ªØ li·ªáu h·ªá th·ªëng, h√£y th√¥ng b√°o r·∫±ng b·∫°n ch∆∞a c√≥ th√¥ng tin c·ª• th·ªÉ v√† ƒë·ªÅ xu·∫•t ng∆∞·ªùi d√πng li√™n h·ªá h·ªó tr·ª£ thay v√¨ t·ª± √Ω b·ªãa ƒë·∫∑t th√¥ng tin.\n\nD∆∞·ªõi ƒë√¢y l√† c√¢u h·ªèi t·ª´ ng∆∞·ªùi d√πng: \"{{ $json.chatInput }}\". H√£y ph√¢n t√≠ch v√† ph·∫£n h·ªìi d·ª±a tr√™n c√°c quy t·∫Øc h·ªá th·ªëng ƒë√£ thi·∫øt l·∫≠p.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        416,
        -96
      ],
      "id": "a3892218-25d0-47a1-aaf8-4076c08be34e",
      "name": "AI Agent",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        176,
        176
      ],
      "id": "155f70cf-0ca1-40a8-93e1-b37081549dcd",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "2caGiCFtfMsI7tzU",
          "name": "Tieanh's Redis server"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        0,
        160
      ],
      "id": "e41bac2a-aabf-490c-8805-e50ee0b21f14",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "NsVrvFwboafcPjAg",
          "name": "Tieanh's Gemini"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        384,
        352
      ],
      "id": "bd7a977b-7add-45dd-834f-1c19b0cc543f",
      "name": "Embeddings Google Gemini",
      "credentials": {
        "googlePalmApi": {
          "id": "NsVrvFwboafcPjAg",
          "name": "Tieanh's Gemini"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        688,
        352
      ],
      "id": "426b2e6a-3d74-426f-ae3c-afb9b33404eb",
      "name": "Embeddings Google Gemini1",
      "credentials": {
        "googlePalmApi": {
          "id": "NsVrvFwboafcPjAg",
          "name": "Tieanh's Gemini"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "‚ö†Ô∏è SYSTEM PROFILE CONTEXT ‚Äî HIGHEST PRIORITY\n\nThis tool contains ONLY system-level identity and global rules of the Learnova platform.\n\nIncludes:\n- Platform name, purpose, and vision\n- Core system capabilities and limitations\n- Global behavior rules for the AI\n- System-wide terminology and definitions\n\nSTRICT RULES:\n- DO NOT use this tool for course content\n- DO NOT use this tool for lessons, tutorials, or learning materials\n- DO NOT answer programming or study questions using this tool\n\nUse this tool ONLY when:\n- The user asks \"what is Learnova\"\n- The user asks about platform identity, system behavior, or global rules\n- The AI needs authoritative system context\n\nIf the question is about learning content, courses, or lessons ‚Üí DO NOT use this tool.\n",
        "tableName": {
          "__rl": true,
          "value": "system_profile_embeddings",
          "mode": "list",
          "cachedResultName": "system_profile_embeddings"
        },
        "includeDocumentMetadata": false,
        "options": {
          "queryName": "match_system_profile"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        688,
        176
      ],
      "id": "2548f384-18fb-4d4a-8ab8-9af89a4ac752",
      "name": "Supabase Vector Store (System Profile)",
      "credentials": {
        "supabaseApi": {
          "id": "Gx25qU6nkxxOH5Qm",
          "name": "Tieanh's SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "üìö COURSE LEARNING CONTEXT\n\nThis tool contains educational content for learners.\n\nIncludes:\n- Course materials\n- Lessons and chapters\n- Programming tutorials and explanations\n- Technical knowledge used for learning and practice\n\nSTRICT RULES:\n- DO NOT use this tool for system identity or platform rules\n- DO NOT answer \"what is Learnova\" or system questions using this tool\n\nUse this tool ONLY when:\n- The user asks technical or learning questions\n- The user asks about programming concepts, tutorials, or lessons\n- The user wants explanations, examples, or study help\n\nIf the question is about platform identity or system behavior ‚Üí DO NOT use this tool.\n",
        "tableName": {
          "__rl": true,
          "value": "course_embeddings",
          "mode": "list",
          "cachedResultName": "course_embeddings"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        384,
        176
      ],
      "id": "90f4ca60-cef6-49e6-82f0-200d41b35025",
      "name": "Supabase Vector Store (Course)",
      "credentials": {
        "supabaseApi": {
          "id": "Gx25qU6nkxxOH5Qm",
          "name": "Tieanh's SUPABASE"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "chienthannodejs@gmail.com",
        "toEmail": "phama9162@gmail.com",
        "subject": "[H·ªá th·ªëng Learnova] Th√¥ng b√°o l·ªói v·∫≠n h√†nh AI",
        "html": "=<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <title>Th√¥ng b√°o l·ªói h·ªá th·ªëng AI</title>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <style>\n      body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f7f9fc; margin: 0; padding: 20px; }\n      .container { max-width: 480px; margin: 0 auto; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); padding: 30px; }\n      .title { font-size: 20px; color: #d9534f; margin-bottom: 16px; font-weight: 700; }\n      .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-bottom: 2px solid #f7f9fc; padding-bottom: 10px; }\n      .brand { font-size: 18px; font-weight: 700; color: #1d4e8f; }\n      .error-box { background-color: #fff5f5; border-left: 4px solid #d9534f; padding: 15px; margin: 20px 0; border-radius: 4px; font-family: monospace; font-size: 13px; color: #333; overflow-x: auto; white-space: pre-wrap; }\n      .footer { font-size: 12px; color: #999999; margin-top: 30px; text-align: center; }\n      .status-badge { background-color: #d9534f; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; text-transform: uppercase; }\n    </style>\n  </head>\n  <body>\n    <div class=\"container\">\n      <div class=\"header\">\n        <div class=\"brand\">Learnova Monitor</div>\n        <div class=\"status-badge\">Critical Error</div>\n      </div>\n      <h2 class=\"title\">Ph√°t hi·ªán l·ªói AI Agent!</h2>\n      <p>Ch√†o <strong>qu·∫£n tr·ªã vi√™n Ph·∫°m Ti√™n Anh</strong>, h·ªá th·ªëng v·ª´a ghi nh·∫≠n m·ªôt l·ªói v·∫≠n h√†nh t·ª´ AI Agent.</p>\n      \n      <div class=\"error-box\">\n        <strong>Th√¥ng ƒëi·ªáp l·ªói:</strong><br>\n        {{ $node[\"AI Agent\"].json.message || \"The service is receiving too many requests from you\" }}\n      </div>\n\n      <p><strong>Th·ªùi gian ph√°t hi·ªán:</strong> {{ $now.format('HH:mm:ss - DD/MM/YYYY') }}</p>\n      <p>H·ªá th·ªëng hi·ªán t·∫°i ƒëang g·∫∑p l·ªói <strong>Rate Limit</strong> t·ª´ Google Gemini. B·∫°n h√£y ki·ªÉm tra l·∫°i l∆∞u l∆∞·ª£ng truy c·∫≠p ho·∫∑c n√¢ng c·∫•p g√≥i API.</p>\n      \n      <div class=\"footer\">\n        ¬© 2026 Learnova Platform - dev by Ph·∫°m Ti√™n Anh. All rights reserved.\n      </div>\n    </div>\n  </body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        1168,
        -80
      ],
      "id": "c4a40fa6-a491-4a93-9f86-42c9df50cd54",
      "name": "Send email1",
      "webhookId": "af9823f0-294c-44b3-a40d-87f24974efaf",
      "retryOnFail": false,
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "smtp": {
          "id": "jlA2QqlAr9UmVD9F",
          "name": "SMTP account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "message": "‚ö†Ô∏è H·ªá th·ªëng ƒëang qu√° t·∫£i. Qu·∫£n tr·ªã vi√™n Ph·∫°m Ti√™n Anh s·∫Ω s·ªõm kh·∫Øc ph·ª•c s·ª± c·ªë n√†y. B·∫°n vui l√≤ng th·ª≠ l·∫°i sau nh√©!",
        "waitUserReply": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        912,
        -80
      ],
      "id": "4f87edc2-883c-4bac-a1eb-e52a4ae44a2a",
      "name": "Respond to Chat"
    },
    {
      "parameters": {
        "message": "={{ $node[\"AI Agent\"].json[\"output\"] }}",
        "waitUserReply": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        816,
        -240
      ],
      "id": "0e97c59b-904a-405a-9e44-9c2490dddcae",
      "name": "Respond to Chat1"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Respond to Chat1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store (Course)",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store (System Profile)",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store (System Profile)": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store (Course)": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Send email1": {
      "main": [
        []
      ]
    },
    "Respond to Chat": {
      "main": [
        [
          {
            "node": "Send email1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "executionTimeout": -1,
    "errorWorkflow": "94rYD9yWSvVNWNEGiQ4nG"
  },
  "versionId": "4371bf6b-61c7-455d-aaf3-49296818cf6e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "aa0d61baa79d86b6f813abe8ede138cd5e00c5ba3b6baaec012b10b9ce4f4b8a"
  },
  "id": "qr8982kT6yw4I7ukx5kqE",
  "tags": []
}